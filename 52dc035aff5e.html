<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Chrome插件开发 · Leo's Blog</title><meta name="description" content="Chrome插件开发 - Tauleos"><meta name="google-site-verification" content="y-sRxe2Toq8nFRU8PiEYywkdUoWdk_UYysZDKbnM7Ck"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://tauleos.github.io/atom.xml" title="Leo's Blog"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Leo's Blog" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVES</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">TAGS</a></li><li class="nav-list-item"><a href="https://github.com/Tauleos" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Chrome插件开发</h1><div class="post-info">2024年10月25日</div><div class="post-content"><p>chrome浏览器的插件相信大家在日常生活中都会用到，应用市场上的各种插件不仅个性化了我们的浏览器UI设置（比如各种tab页主题设置插件），同时也提供了更为强大的辅助工具。</p>
<span id="more"></span>


<blockquote>
<p>对我们前端来说。用好各种插件也能极大的提升日常工作中的开发效率。那么问题来了。我们如何能够更快更好的使用chrome插件呢？</p>
</blockquote>
<p>且听笔者娓娓道来~</p>
<hr>
<div class="tip">
在日常工作过程中。笔者接到了一个普通的页面开发的需求；仅需要展示一个表格数据即可，当后端的接口文档发给我时，我对着一个表格大约七八十个的字段陷入了沉思😱（我不仅要调整映射，还要把下划线改成驼峰），本着懒癌症晚期患者的原则，我拿起了chrome插件的学习手册。。。
</div>

<h1 id="一、工欲善其事必先利其器"><a href="#一、工欲善其事必先利其器" class="headerlink" title="一、工欲善其事必先利其器"></a>一、工欲善其事必先利其器</h1><h2 id="chrome插件基本介绍"><a href="#chrome插件基本介绍" class="headerlink" title="chrome插件基本介绍"></a>chrome插件基本介绍</h2><ul>
<li>Manifest （清单文件）</li>
<li>Service_worker（后台脚本）</li>
<li>UI Elements （页面元素）</li>
<li>Content Script （内容脚本）</li>
</ul>
<p>整体的结构如下所示：<br><img src="/images/extension/1611729839420_.pic.jpg" alt="结构图"></p>
<h2 id="Manifest"><a href="#Manifest" class="headerlink" title="Manifest"></a>Manifest</h2><p>相当于插件的 meta 信息，包含插件的名称、版本号、图标、脚本文件名称等，这个文件是每个插件都必须提供的。</p>
<p>主要的配置项介绍如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;extract table&quot;</span>, <span class="comment">// 名称</span></span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;An introductory tutorial&quot;</span>, <span class="comment">// 描述</span></span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0&quot;</span>, <span class="comment">// 插件的版本</span></span><br><span class="line">  <span class="string">&quot;manifest_version&quot;</span>: <span class="number">3</span>, <span class="comment">// 清单的版本，目前都是使用 V3</span></span><br><span class="line">  <span class="comment">// action 字段主要描述点击右上角图标弹出的页面</span></span><br><span class="line">  <span class="string">&quot;action&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;default_popup&quot;</span>: <span class="string">&quot;index.html&quot;</span> <span class="comment">// 对应的入口 html 文件（Popup 在后面介绍）</span></span><br><span class="line">    <span class="string">&quot;default_title&quot;</span>: <span class="string">&quot;Garfish Module&quot;</span>,</span><br><span class="line">    <span class="string">&quot;default_icon&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;16&quot;</span>: <span class="string">&quot;favicon.ico&quot;</span>,</span><br><span class="line">      <span class="string">&quot;48&quot;</span>: <span class="string">&quot;favicon.ico&quot;</span>,</span><br><span class="line">      <span class="string">&quot;128&quot;</span>: <span class="string">&quot;favicon.ico&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">    <span class="comment">// 需要使用一些特殊 API 时需要在 permissions 声明权限，会提示给用户</span></span><br><span class="line">  <span class="string">&quot;permissions&quot;</span>: [<span class="string">&quot;storage&quot;</span>, <span class="string">&quot;scripting&quot;</span>],</span><br><span class="line">  <span class="comment">// 哪些域名允许使用插件</span></span><br><span class="line">  <span class="string">&quot;host_permissions&quot;</span>: [<span class="string">&quot;&lt;all_urls&gt;&quot;</span>],</span><br><span class="line">  <span class="comment">// 声明 background service worker 的路径，在后面介绍</span></span><br><span class="line">  <span class="string">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 声明 content script 的入口文件路径、允许使用的域名以及执行时机</span></span><br><span class="line">  <span class="string">&quot;content_scripts&quot;</span>: [&#123;</span><br><span class="line">    <span class="string">&quot;js&quot;</span>: [<span class="string">&quot;content.js&quot;</span>]</span><br><span class="line">    <span class="string">&quot;matches&quot;</span>: [<span class="string">&quot;&lt;all_urls&gt;&quot;</span>],</span><br><span class="line">    <span class="comment">//  &quot;document_start&quot; &quot;document_idle&quot; &quot;document_end&quot; 三个值</span></span><br><span class="line">    <span class="string">&quot;run_at&quot;</span>: <span class="string">&quot;document_idle&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Service-worker（后台脚本）"><a href="#Service-worker（后台脚本）" class="headerlink" title="Service_worker（后台脚本）"></a>Service_worker（后台脚本）</h2><p>manifest v2中称之为<code>background script</code>,v3统一成 service_worker.</p>
<p>可以调用全部的 chrome 插件 API，实现跨域请求、网页截屏、弹出 chrome 通知消息等功能。插件激活后会在浏览器后台默默运行。</p>
<h2 id="UI-Elements-（页面元素）"><a href="#UI-Elements-（页面元素）" class="headerlink" title="UI Elements （页面元素）"></a>UI Elements （页面元素）</h2><p> 主要包括点击插件的弹出框（popup）、插件的配置页（optons）,插入到控制台的tab页等等。</p>
<h2 id="Content-Script-（内容脚本）"><a href="#Content-Script-（内容脚本）" class="headerlink" title="Content Script （内容脚本）"></a>Content Script （内容脚本）</h2><p>是插件注入到页面的脚本，但是不会体现在页面 DOM 结构里。在一个单独的沙盒内运行，可以操作页面的DOM、调用有限的插件API等。</p>
<h2 id="页面通信"><a href="#页面通信" class="headerlink" title="页面通信"></a>页面通信</h2><blockquote>
<p>由于content_scripts是在网页中运行的，而非在扩展的上下文中，因此它们通常需要某种方式与扩展的其余部分进行通信。extensions 和content_scripts之间的通信通过使用消息传递进行。 任何一方都可以侦听从另一端发送的消息，并在同一通道上做出响应。</p>
</blockquote>
<h3 id="从content-scripts发送消息的代码如下所示："><a href="#从content-scripts发送消息的代码如下所示：" class="headerlink" title="从content_scripts发送消息的代码如下所示："></a>从content_scripts发送消息的代码如下所示：</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> chrome.<span class="property">runtime</span>.<span class="title function_">sendMessage</span>(&#123;<span class="attr">greeting</span>: <span class="string">&quot;hello&quot;</span>&#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h3 id="从【options-page-bakcground-popup】等位置发送到-content-scripts的-代码示例"><a href="#从【options-page-bakcground-popup】等位置发送到-content-scripts的-代码示例" class="headerlink" title="从【options_page,bakcground,popup】等位置发送到 content_scripts的 代码示例:"></a>从【options_page,bakcground,popup】等位置发送到 content_scripts的 代码示例:</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [tab] = <span class="keyword">await</span> chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">lastFocusedWindow</span>: <span class="literal">true</span>&#125;);</span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> chrome.<span class="property">tabs</span>.<span class="title function_">sendMessage</span>(tab.<span class="property">id</span>, &#123;<span class="attr">greeting</span>: <span class="string">&quot;hello&quot;</span>&#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h3 id="通过runtime-onMessage事件侦听器来处理消息"><a href="#通过runtime-onMessage事件侦听器来处理消息" class="headerlink" title="通过runtime.onMessage事件侦听器来处理消息"></a>通过runtime.onMessage事件侦听器来处理消息</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(</span><br><span class="line">  <span class="keyword">function</span>(<span class="params">request, sender, sendResponse</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(sender.<span class="property">tab</span> ? <span class="string">&quot;from a content script:&quot;</span> + sender.<span class="property">tab</span>.<span class="property">url</span> :<span class="string">&quot;from the extension&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (request.<span class="property">greeting</span> === <span class="string">&quot;hello&quot;</span>)</span><br><span class="line">      <span class="title function_">sendResponse</span>(&#123;<span class="attr">farewell</span>: <span class="string">&quot;goodbye&quot;</span>&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>除此之外，插件还提供了长连接来实现通信。</p>
<h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><p>修改了devtools页面的代码时，需要先在 扩展程序页面下重新加载插件，然后关闭再打开开发者工具即可，无需刷新页面。</p>
<h1 id="二、牛刀小试"><a href="#二、牛刀小试" class="headerlink" title="二、牛刀小试"></a>二、牛刀小试</h1><h2 id="首先创建好我们的项目文件，设置好我们需要的配置"><a href="#首先创建好我们的项目文件，设置好我们需要的配置" class="headerlink" title="首先创建好我们的项目文件，设置好我们需要的配置"></a>首先创建好我们的项目文件，设置好我们需要的配置</h2><p><img src="/images/extension/1621729839421_.pic.jpg" alt="image.png"></p>
<h2 id="在popup中实现界面的绘制和按钮事件的绑定"><a href="#在popup中实现界面的绘制和按钮事件的绑定" class="headerlink" title="在popup中实现界面的绘制和按钮事件的绑定"></a>在popup中实现界面的绘制和按钮事件的绑定</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> targetDom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;targetDom&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> columnKey = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;key&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;clickBtn&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> result = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#result&#x27;</span>);</span><br><span class="line"><span class="comment">//发送dom给content去解析</span></span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="title function_">async</span> ()=&gt;&#123;</span><br><span class="line">  <span class="keyword">var</span> classname = targetDom.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">if</span>(classname)&#123;</span><br><span class="line">    selector = classname.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>).<span class="title function_">map</span>(<span class="function"><span class="params">i</span>=&gt;</span><span class="string">`.<span class="subst">$&#123;i&#125;</span>`</span>).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123;<span class="attr">active</span>:<span class="literal">true</span>,<span class="attr">currentWindow</span>:<span class="literal">true</span>&#125;,<span class="function">(<span class="params">tabs</span>)=&gt;</span>&#123;</span><br><span class="line">      chrome.<span class="property">tabs</span>.<span class="title function_">sendMessage</span>(tabs[<span class="number">0</span>].<span class="property">id</span>,&#123;selector,columnKey&#125;,<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;response&#x27;</span>,res);</span><br><span class="line">        result.<span class="property">innerText</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res,<span class="literal">null</span>,<span class="number">4</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="在content-scripts中接收参数并完成dom结构解析，最终把数据返回给popup送显。"><a href="#在content-scripts中接收参数并完成dom结构解析，最终把数据返回给popup送显。" class="headerlink" title="在content_scripts中接收参数并完成dom结构解析，最终把数据返回给popup送显。"></a>在content_scripts中接收参数并完成dom结构解析，最终把数据返回给popup送显。</h2><p>这样我们就完成了一个基础版的插件开发。当然，在现代开发模式下，我们肯定不能接受如此简陋的开发模式，那么我们如何进行下一步的优化呢，我们下篇继续~</p>
</div></article></div></main><footer><div class="paginator"><a href="/dcc6a7fe224e.html" class="prev">上一篇</a><a href="/db04494e7d11.html" class="next">下一篇</a></div><div id="gitalk-container"></div><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" async></script><script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.10.0/js/md5.min.js" async></script><script>var ds = document.createElement('link');
ds.rel = 'stylesheet';ds.async = true;
ds.href = 'https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
window.onload = function() {
  var gitalk = new Gitalk({
    clientID: '62e01f3aa3f140c5af8a',
    clientSecret: '8f02698609ba488706c5e67839f0bbf46861554f',
    repo: 'Tauleos.github.io',
    owner: 'Tauleos',
    admin: ['Tauleos'],
    id: md5(window.location.pathname),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })
  gitalk.render('gitalk-container');
}</script><div class="copyright"><p id="host_by"><span id="busuanzi_container_site_pv">&nbsp;本站总访问量 &nbsp;<span id="busuanzi_value_site_pv"><i class="fa fa-spinner"></i></span> 次,</span><span id="busanzi_container_site_uv">&nbsp;本站总访问人数 &nbsp;<span id="busuanzi_value_site_uv"><i class="fa fa-spinner"></i></span> 次.</span></p><p>© 2017 - 2024 created by <a href="https://tauleos.github.io">Tauleos</a>,Looking for better life and peace.</p><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script></div></footer></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body></html>